generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model alumnos {
  id            Int           @id @default(autoincrement())
  seccion_id    Int?
  apoderado_id  Int?
  nombres       String        @db.VarChar(100)
  dni           String        @unique @db.VarChar(8)
  codigo_qr     String?       @unique @default(dbgenerated("(uuid_generate_v4())::text"))
  qr_url        String?
  estado_activo Boolean?      @default(true)
  apoderados    apoderados?   @relation(fields: [apoderado_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  secciones     secciones?    @relation(fields: [seccion_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  asistencias   asistencias[]

  @@index([codigo_qr], map: "idx_alumnos_qr")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model apoderados {
  id       Int       @id @default(autoincrement())
  nombres  String    @db.VarChar(100)
  telefono String    @db.VarChar(15)
  correo   String?   @db.VarChar(100)
  alumnos  alumnos[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model asistencias {
  id            BigInt        @id @default(autoincrement())
  alumno_id     Int?
  trabajador_id Int?
  fecha         DateTime?     @default(dbgenerated("CURRENT_DATE")) @db.Date
  hora_escaneo  DateTime?     @db.Time(6)
  estado        String?       @db.VarChar(20)
  notificado    Boolean?      @default(false)
  alumnos       alumnos?      @relation(fields: [alumno_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  trabajadores  trabajadores? @relation(fields: [trabajador_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([alumno_id, fecha])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model colegios {
  id              Int              @id @default(autoincrement())
  nombre          String           @db.VarChar(100)
  ruc             String           @unique @db.VarChar(11)
  direccion       String?          @db.VarChar(255)
  logo_url        String?          @db.VarChar(255)
  created_at      DateTime?        @default(now()) @db.Timestamptz(6)
  config_horarios config_horarios?
  grados          grados[]
  trabajadores    trabajadores[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model config_horarios {
  id           Int       @id @default(autoincrement())
  colegio_id   Int?      @unique
  hora_entrada DateTime? @default(dbgenerated("'07:30:00'::time without time zone")) @db.Time(6)
  hora_tarde   DateTime? @default(dbgenerated("'07:45:00'::time without time zone")) @db.Time(6)
  hora_falta   DateTime? @default(dbgenerated("'08:15:00'::time without time zone")) @db.Time(6)
  colegios     colegios? @relation(fields: [colegio_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model grados {
  id         Int         @id @default(autoincrement())
  colegio_id Int?
  nombre     String      @db.VarChar(50)
  colegios   colegios?   @relation(fields: [colegio_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  secciones  secciones[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model roles {
  id           Int            @id @default(autoincrement())
  nombre       String         @unique @db.VarChar(50)
  trabajadores trabajadores[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model secciones {
  id            Int           @id @default(autoincrement())
  grado_id      Int?
  trabajador_id Int?
  letra         String        @db.Char(1)
  alumnos       alumnos[]
  grados        grados?       @relation(fields: [grado_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  trabajadores  trabajadores? @relation(fields: [trabajador_id], references: [id], onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model superadmins {
  id         Int       @id @default(autoincrement())
  nombres    String    @db.VarChar(100)
  email      String    @unique @db.VarChar(100)
  password   String    @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model trabajadores {
  id            Int           @id @default(autoincrement())
  colegio_id    Int?
  rol_id        Int?
  nombres       String        @db.VarChar(100)
  dni           String        @unique @db.VarChar(8)
  email         String        @unique @db.VarChar(100)
  password      String        @db.VarChar(255)
  estado_activo Boolean?      @default(true)
  asistencias   asistencias[]
  secciones     secciones[]
  colegios      colegios?     @relation(fields: [colegio_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  roles         roles?        @relation(fields: [rol_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
